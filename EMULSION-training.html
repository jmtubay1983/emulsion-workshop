<!DOCTYPE html>
<html lang="en"><head>
<script src="EMULSION-training_files/libs/clipboard/clipboard.min.js"></script>
<script src="EMULSION-training_files/libs/quarto-html/tabby.min.js"></script>
<script src="EMULSION-training_files/libs/quarto-html/popper.min.js"></script>
<script src="EMULSION-training_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="EMULSION-training_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EMULSION-training_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="EMULSION-training_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="Jerrold Tubay">
  <meta name="dcterms.date" content="2025-01-10">
  <title>ü¶† Workshop: From Theory to Simulation</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="EMULSION-training_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="EMULSION-training_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="EMULSION-training_files/libs/revealjs/dist/theme/quarto-534cd8e3a96973385dffff3f4709048d.css">
  <link href="EMULSION-training_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="EMULSION-training_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="EMULSION-training_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="EMULSION-training_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">ü¶† Workshop: From Theory to Simulation</h1>
  <p class="subtitle">A Practical Guide to Mechanistic Disease Modeling with EMULSION</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Jerrold Tubay 
</div>
</div>
</div>

  <p class="date">2025-01-10</p>
</section>
<section class="slide level2">

<p><strong>Origin:</strong> Adapted from doctoral training by S√©bastien Picault (INRAE)</p>
<h3 id="learning-objectives">üéØ Learning Objectives</h3>
<ul>
<li><strong>Conceptual Mapping:</strong> Translate biological assumptions into formal state-machine diagrams.</li>
<li><strong>Stochastic Literacy:</strong> Understand the role of random chance in disease dynamics.</li>
<li><strong>Parameter Sensitivity:</strong> Identify which biological variables impact outbreak trajectories.</li>
<li><strong>Simulation-Based Reasoning:</strong> Use model outputs to justify public health interventions.</li>
</ul>
</section>
<section class="slide level2">

<p>In the following exercises, we will start with a simple model and see how <strong>EMULSION</strong> helps to introduce new features to make it more realistic and represent detection and control measures.</p>
<p>Meanwhile, a few side issues will also be explored to illustrate specific points in modelling.</p>
</section>
<section class="slide level2">

<p>The ‚Äúevolution‚Äù of the models goes through the following diagram:</p>

<img data-src="img/progression.svg" class="r-stretch quarto-figure-center"><p class="caption">Model progression</p><p>Solutions are proposed for each exercise in the <code>solutions</code> directory.</p>
<p>Note the transition from <strong>Compartmental (Step 1)</strong> to <strong>Hybrid (Step 6)</strong> paradigms ‚Äî this is the core strength of EMULSION.</p>
</section>
<section class="slide level2">

<h3 id="module-1-sir-fundamentals">üì¶ Module 1: SIR Fundamentals</h3>
<div style="padding: 15px; background-color: #e7f3ff; border-left: 5px solid #2196F3;">
<p>
We begin by translating the classic <b>Susceptible-Infectious-Recovered</b> flowchart into a computer model.
</p>
</div>
</section>
<section id="exercise-1-your-first-emulsion-model" class="slide level2">
<h2>üü¢ Exercise 1: Your First EMULSION Model</h2>
<p>In this exercise, we explore <strong><code>exercises/step1.yaml</code></strong>. This file describes a discrete-time, compartment-based <strong>SIR (Susceptible-Infectious-Recovered)</strong> model.</p>
</section>
<section class="slide level2 scrollable">

<h3 id="anatomy-of-the-model">1.1 Anatomy of the Model</h3>
<p>Open the file exercises/step1.yaml in your editor. EMULSION models are written in <strong>YAML</strong>, a format that relies on strict indentation to organize information. As you browse the code, locate these four core sections:</p>
<ol type="1">
<li><strong><code>state_machines</code></strong>: Defines the ‚Äúflowchart‚Äù of the disease‚Äîthe states (<strong>S</strong>, <strong>I</strong>, and <strong>R</strong>) and the logical paths between them.</li>
<li><strong><code>transitions</code></strong>: Rules for moving between states. Look for the <code>rate</code> keyword; this is where biological transitions are calculated.</li>
<li><strong><code>parameters</code></strong>: Contains constants like <code>transmission_rate</code> and <code>recovery_duration</code>.</li>
<li><strong><code>initial_conditions</code></strong>: Sets initial conditions such as ‚ÄúPatient Zero‚Äù (how many individuals start in the <strong>I</strong> state).</li>
</ol>
</section>
<section class="slide level2">

<h3 id="running-the-simulation">1.2 Running the Simulation</h3>
<p>Instead of using an external terminal, we will execute the model directly within this notebook using the <strong>Code Cell</strong> immediately following this description.</p>
<p><strong>Instruction:</strong> The next cell uses the <code>%%bash</code> magic command. This tells Jupyter to run the code as a terminal script. It will automatically navigate to the <code>exercises</code> directory and launch EMULSION.</p>
<p><strong>To run the model:</strong> Click on the next cell and press <strong>Shift + Enter</strong>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {bash} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href=""></a>%%bash </span>
<span id="cb1-2"><a href=""></a>cd exercises</span>
<span id="cb1-3"><a href=""></a>emulsion run --plot step1.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<h3 id="analyzing-the-results">1.3 Analyzing the Results</h3>
<p>Once the simulation finishes, look for a link to an <strong>HTML plot</strong> in the cell output: <a href="exercises/img/stoch_compart_SIR.html">exercises/img/stoch_compart_SIR.html</a>. Open it to view the interactive epidemic curves.</p>
<p><strong>Discussion Points:</strong></p>
<ul>
<li><strong>The Peak:</strong> At what time step does the number of Infectious individuals reach its maximum?</li>
<li><strong>Persistence:</strong> Does the number of Susceptible individuals ever reach zero? If not, why?</li>
<li><strong>Consistency:</strong> Since this model is stochastic, does the graph look identical every time?</li>
</ul>
</section>
<section class="slide level2">

<p>Plots corresponding to simulation outcomes are produced in a file named after the <code>model_name</code> value specified in the YAML file: <a href="exercises/img/stoch_compart_SIR.html">img/stoch_compart_SIR.html</a>.</p>
<p>When this notebook is running online with Binder, the plot file does not open automatically. You have to open the link above and click <strong>Trust HTML</strong> to view the results.</p>

<img data-src="img/html.png" class="r-stretch quarto-figure-center"><p class="caption">HTML Preview</p><p>These plots are built from the simulation outputs which are stored in a CSV file named <code>counts.csv</code>, which by default is located in the <code>outputs/</code> directory: <a href="exercises/outputs/counts.csv">outputs/counts.csv</a>.</p>
</section>
<section class="slide level2">

<p><strong>NOTES:</strong> - Running <code>emulsion -h</code> provides all possible commands and options. - In the terminal, the command supports completion (start typing and hit TAB to view proposals).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource {bash} number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href=""></a>%%bash</span>
<span id="cb2-2"><a href=""></a>emulsion -h</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<h3 id="view-model-diagrams">1.3 View model diagrams</h3>
<p>Produce a graphical representation of the state machines of the model:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb3-2"><a href=""></a><span class="ex">emulsion</span> diagrams step1.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<img data-src="solutions/img/stoch_compart_SIR_health_state_machine.svg" class="r-stretch quarto-figure-center"><p class="caption">stoch_compart_SIR_health_state_machine.svg</p></section>
<section class="slide level2">

<h3 id="change-simulation-conditions">1.4 Change simulation conditions</h3>
<p>Play with the model through the command-line interface: for instance, to run only one repetition (<code>-r 1</code>) but observe the evolution of the system in the long run (500 days: <code>-t 500</code>) with different parameter values (<code>-p</code> to change parameter value):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb4-2"><a href=""></a><span class="bu">cd</span> exercises</span>
<span id="cb4-3"><a href=""></a><span class="ex">emulsion</span> run <span class="at">--plot</span> step1.yaml <span class="at">-r</span> 1 <span class="at">-t</span> 500 <span class="at">-p</span> transmission_I=0.2 <span class="at">-p</span> initial_prevalence=0.1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="exercise-2-introduce-demography-and-age-structure" class="slide level2">
<h2>Exercise 2 ‚Äî Introduce demography and age structure</h2>
<p>Open file <code>exercises/step2.yaml</code> and incorporate the following changes.</p>
</section>
<section class="slide level2">

<h3 id="add-age-groups">2.1 Add age groups</h3>
<p>We will represent two age groups: <strong>juveniles</strong> (J) and <strong>adults</strong> (A), juveniles becoming adults at rate <code>maturation=0.05</code>.<br>
We will take example on existing parameters, processes and state machines.</p>
<h4 id="rename-the-model">Rename the model</h4>
<ul>
<li>Change model name from <code>stoch_compart_SIR</code> to <code>stoch_compart_SIR_JA</code>.</li>
</ul>
<h4 id="add-a-process-at-animals-level">Add a process at animals level</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><a href=""></a><span class="fu">processes</span><span class="kw">:</span></span>
<span id="cb5-2"><a href=""></a><span class="at">  </span><span class="fu">animals</span><span class="kw">:</span></span>
<span id="cb5-3"><a href=""></a><span class="at">    </span><span class="kw">-</span><span class="at"> health_state</span></span>
<span id="cb5-4"><a href=""></a><span class="at">    </span><span class="kw">-</span><span class="at"> age_group</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<h4 id="add-a-state-machine-age_group">Add a state machine <code>age_group</code></h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href=""></a><span class="fu">state_machines</span><span class="kw">:</span></span>
<span id="cb6-2"><a href=""></a><span class="at">  </span><span class="fu">age_group</span><span class="kw">:</span></span>
<span id="cb6-3"><a href=""></a><span class="at">    </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'...'</span></span>
<span id="cb6-4"><a href=""></a><span class="at">    </span><span class="fu">states</span><span class="kw">:</span></span>
<span id="cb6-5"><a href=""></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">J</span><span class="kw">:</span></span>
<span id="cb6-6"><a href=""></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Juveniles'</span></span>
<span id="cb6-7"><a href=""></a><span class="at">          </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'...'</span></span>
<span id="cb6-8"><a href=""></a><span class="at">          </span><span class="fu">fillcolor</span><span class="kw">:</span><span class="at"> </span><span class="st">'purple'</span></span>
<span id="cb6-9"><a href=""></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">A</span><span class="kw">:</span></span>
<span id="cb6-10"><a href=""></a><span class="at">          </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Adults'</span></span>
<span id="cb6-11"><a href=""></a><span class="at">          </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'a...'</span></span>
<span id="cb6-12"><a href=""></a><span class="at">          </span><span class="fu">fillcolor</span><span class="kw">:</span><span class="at"> </span><span class="st">'darkred'</span></span>
<span id="cb6-13"><a href=""></a><span class="at">    </span><span class="fu">transitions</span><span class="kw">:</span></span>
<span id="cb6-14"><a href=""></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">from</span><span class="kw">:</span><span class="at"> J</span></span>
<span id="cb6-15"><a href=""></a><span class="at">        </span><span class="fu">to</span><span class="kw">:</span><span class="at"> A</span></span>
<span id="cb6-16"><a href=""></a><span class="at">        </span><span class="fu">rate</span><span class="kw">:</span><span class="at"> </span><span class="st">'maturation'</span></span>
<span id="cb6-17"><a href=""></a><span class="at">        </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'maturation of juvenile individuals into adults'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<h4 id="add-parameter-maturation">Add parameter <code>maturation</code></h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href=""></a><span class="fu">parameters</span><span class="kw">:</span></span>
<span id="cb7-2"><a href=""></a><span class="at">  </span><span class="fu">maturation</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb7-3"><a href=""></a><span class="at">    </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'maturation rate, i.e. speed at which juveniles become adults'</span></span>
<span id="cb7-4"><a href=""></a><span class="at">    </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.05</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><br></p>
<h3 id="run-the-model-and-observe-the-results.">2.2 Run the model and observe the results.</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb8-2"><a href=""></a><span class="bu">cd</span> exercises</span>
<span id="cb8-3"><a href=""></a><span class="ex">emulsion</span> run <span class="at">--plot</span> step2.yaml <span class="at">--silent</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>‚Ä¶ and check the results: <a href="exercises/img/stoch_compart_SIR_JA.html">img/stoch_compart_SIR_JA.html</a></p>
</section>
<section class="slide level2">

<p><strong>IMPORTANT NOTE:</strong></p>
<p>Initial individuals are <strong>distributed randomly</strong> in <code>J</code> and <code>A</code> states. This is because the prototypes used for defining the initial conditions do not specify the value of <code>age_group</code>.</p>
<p>Let‚Äôs assume that juveniles should be regarded as the default <code>age_group</code> state.</p>
<ul>
<li>modify the initial prototypes to assign a ‚Äúdefault‚Äù age group:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb9-1"><a href=""></a><span class="at">      </span><span class="fu">prototypes</span><span class="kw">:</span></span>
<span id="cb9-2"><a href=""></a><span class="at">        </span><span class="fu">animals</span><span class="kw">:</span></span>
<span id="cb9-3"><a href=""></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">healthy</span><span class="kw">:</span></span>
<span id="cb9-4"><a href=""></a><span class="at">              </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'healthy animals'</span></span>
<span id="cb9-5"><a href=""></a><span class="at">              </span><span class="fu">health_state</span><span class="kw">:</span><span class="at"> S</span></span>
<span id="cb9-6"><a href=""></a><span class="at">              </span><span class="fu">age_group</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb9-7"><a href=""></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">infectious</span><span class="kw">:</span></span>
<span id="cb9-8"><a href=""></a><span class="at">              </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'infectious animals'</span></span>
<span id="cb9-9"><a href=""></a><span class="at">              </span><span class="fu">health_state</span><span class="kw">:</span><span class="at"> I</span></span>
<span id="cb9-10"><a href=""></a><span class="at">              </span><span class="fu">age_group</span><span class="kw">:</span><span class="at"> default</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<ul>
<li>modify state J in the state machines section to mark it as the default age group state:</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a href=""></a><span class="at">      </span><span class="fu">state_machines</span><span class="kw">:</span></span>
<span id="cb10-2"><a href=""></a><span class="at">      ...</span></span>
<span id="cb10-3"><a href=""></a><span class="at">        </span><span class="fu">age_group</span><span class="kw">:</span></span>
<span id="cb10-4"><a href=""></a><span class="at">          </span><span class="fu">states</span><span class="kw">:</span></span>
<span id="cb10-5"><a href=""></a><span class="at">               </span><span class="kw">-</span><span class="at"> </span><span class="fu">J</span><span class="kw">:</span></span>
<span id="cb10-6"><a href=""></a><span class="at">                   </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Juveniles'</span></span>
<span id="cb10-7"><a href=""></a><span class="at">                   </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> </span><span class="st">'...'</span></span>
<span id="cb10-8"><a href=""></a><span class="at">                   </span><span class="fu">fillcolor</span><span class="kw">:</span><span class="at"> </span><span class="st">'purple'</span></span>
<span id="cb10-9"><a href=""></a><span class="at">                   </span><span class="fu">default</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb10-10"><a href=""></a><span class="at">          ...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<h3 id="add-a-density-dependent-mortality">2.3 Add a density-dependent mortality</h3>
<p>Mortality is represented with a new state ‚ÄúDeceased‚Äù (<code>D</code>) in state machine <code>age_group</code>. It produces a ‚Äúsink‚Äù to put individuals leaving the system.</p>
<p>Add state <code>D</code> <strong>with property <code>autoremove: yes</code></strong> and transitions from both <code>J</code> and <code>A</code> to <code>D</code> with mortality rate <code>mu * total_herd / K</code>.</p>
<ul>
<li><p>variable <code>total_herd</code> represents the total number of animals, automatically defined in EMULSION</p></li>
<li><p>add two new parameters: the base mortality rate <code>mu = 0.05</code> and the carrying capacity of the environment <code>K = 150</code></p></li>
</ul>
</section>
<section class="slide level2">

<h3 id="add-a-birth-dynamics">2.4 Add a birth dynamics</h3>
<p>State machines can define a <code>productions:</code> section (similar to <code>transitions:</code>) to specify from and to which states and at which rate new individuals are produced.</p>
<ul>
<li>create a new prototype <code>newborn</code> for new individuals, specifying their <code>age_group</code> (<code>J</code>) but also their <code>health_state</code> (<code>S</code>, assuming no vertical transmission)</li>
<li>add a production link between <code>A</code> and <code>J</code> (adults produce juveniles) at birth rate <em>b = mu</em> <span class="math inline">\(\times\ 2\)</span>, specifying <code>prototype: newborn</code> for the newly created individuals</li>
</ul>
</section>
<section class="slide level2">

<h3 id="test-your-final-model">2.5 Test your final model</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb11-2"><a href=""></a><span class="bu">cd</span> exercises </span>
<span id="cb11-3"><a href=""></a><span class="ex">emulsion</span> run <span class="at">--plot</span> step2.yaml <span class="at">--silent</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>‚Ä¶ and check the results: <a href="exercises/img/stoch_compart_SIR_JA.html">img/stoch_compart_SIR_JA.html</a></p>
</section>
<section class="slide level2">

<h3 id="check-the-new-diagram">2.6 Check the new diagram</h3>
<p>You can visualize the diagram corresponding to the new state machine:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb12-2"><a href=""></a><span class="bu">cd</span> exercises</span>
<span id="cb12-3"><a href=""></a><span class="ex">emulsion</span> diagrams step2.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">


<img data-src="solutions/img/stoch_compart_SIR_JA_age_group_machine.svg" class="r-stretch quarto-figure-center"><p class="caption">img/stoch_compart_SIR_JA_age_group_machine.svg</p><p><strong>PLEASE NOTE:</strong></p>
<ul>
<li><p>the <code>autoremove</code> state (<code>D</code>) with dotted box</p></li>
<li><p>the <code>production</code> link from <code>A</code> to <code>J</code>, with dashed arrow</p></li>
</ul>
<p><strong>DISCUSSION:</strong></p>
<blockquote>
<p>How would you add disease-induced mortality? (several possibilities)</p>
</blockquote>
</section>
<section class="slide level2">

<h3 id="parenthesis-integrate-simulation-results-with-r-or-other-statistical-sotware">2.7 Parenthesis: Integrate simulation results with R or other statistical sotware</h3>
<p>The default plots produced by EMULSION are not meant to be used but for immediate feedback during model prototyping. Otherwise, the simulation results can be processed with your favourite statistics tool such as <a href="https://www.r-project.org/">R</a>. In what follows, we processed the output in Python for convinience.</p>
<p>First, simulate your model with enough stochastic repetitions</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb13-2"><a href=""></a><span class="bu">cd</span> exercises </span>
<span id="cb13-3"><a href=""></a><span class="ex">emulsion</span> run <span class="at">--plot</span> step2.yaml <span class="at">--silent</span> <span class="at">-r</span> 50</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<p>Then you can use a custom R script to transform and visualize new information from raw simulation data:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-3"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-4"><a href=""></a></span>
<span id="cb14-5"><a href=""></a><span class="co"># Read CSV</span></span>
<span id="cb14-6"><a href=""></a>results <span class="op">=</span> pd.read_csv(<span class="st">"exercises/outputs/counts.csv"</span>)</span>
<span id="cb14-7"><a href=""></a></span>
<span id="cb14-8"><a href=""></a><span class="co"># Number of runs</span></span>
<span id="cb14-9"><a href=""></a>NB_RUNS <span class="op">=</span> results[<span class="st">'simu_id'</span>].nunique()</span>
<span id="cb14-10"><a href=""></a></span>
<span id="cb14-11"><a href=""></a><span class="co"># Prep &amp; compute</span></span>
<span id="cb14-12"><a href=""></a>tmp <span class="op">=</span> results[[<span class="st">'simu_id'</span>, <span class="st">'step'</span>, <span class="st">'I'</span>, <span class="st">'percentage_prevalence'</span>]].copy()</span>
<span id="cb14-13"><a href=""></a>tmp[<span class="st">'persists'</span>] <span class="op">=</span> tmp[<span class="st">'I'</span>] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb14-14"><a href=""></a></span>
<span id="cb14-15"><a href=""></a><span class="kw">def</span> mean_prevalent(s):</span>
<span id="cb14-16"><a href=""></a>    mask <span class="op">=</span> tmp.loc[s.index, <span class="st">'persists'</span>]</span>
<span id="cb14-17"><a href=""></a>    <span class="cf">return</span> (s[mask].mean() <span class="op">/</span> <span class="fl">100.0</span>) <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb14-18"><a href=""></a></span>
<span id="cb14-19"><a href=""></a>grp <span class="op">=</span> tmp.groupby(<span class="st">'step'</span>).agg(</span>
<span id="cb14-20"><a href=""></a>    persistence<span class="op">=</span>(<span class="st">'persists'</span>, <span class="kw">lambda</span> x: x.<span class="bu">sum</span>() <span class="op">/</span> NB_RUNS),</span>
<span id="cb14-21"><a href=""></a>    prevalence<span class="op">=</span>(<span class="st">'percentage_prevalence'</span>, mean_prevalent)</span>
<span id="cb14-22"><a href=""></a>).reset_index()</span>
<span id="cb14-23"><a href=""></a></span>
<span id="cb14-24"><a href=""></a><span class="co"># Plot</span></span>
<span id="cb14-25"><a href=""></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">5</span>))</span>
<span id="cb14-26"><a href=""></a>plt.plot(grp[<span class="st">'step'</span>], grp[<span class="st">'persistence'</span>], label<span class="op">=</span><span class="st">'Persistence'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb14-27"><a href=""></a>plt.plot(grp[<span class="st">'step'</span>], grp[<span class="st">'prevalence'</span>], label<span class="op">=</span><span class="st">'Mean prevalence (persistent runs)'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb14-28"><a href=""></a>plt.xlabel(<span class="st">"Time (days)"</span>)</span>
<span id="cb14-29"><a href=""></a>plt.ylabel(<span class="ss">f"Proportion (on </span><span class="sc">{</span>NB_RUNS<span class="sc">}</span><span class="ss"> repetitions)"</span>)</span>
<span id="cb14-30"><a href=""></a>plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb14-31"><a href=""></a>plt.legend(loc<span class="op">=</span><span class="st">'lower center'</span>)</span>
<span id="cb14-32"><a href=""></a>plt.tight_layout()</span>
<span id="cb14-33"><a href=""></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li><p>Persistence = ‚ÄúDoes infection survive?‚Äù (across runs)</p></li>
<li><p>Prevalence = ‚ÄúHow big is the infection among those surviving runs?‚Äù</p></li>
</ul>
</section>
<section class="slide level2">

</section>
<section>
<section id="exercise-3-non-exponential-durations" class="title-slide slide level1 center">
<h1>‚è±Ô∏è Exercise 3: Non-Exponential Durations</h1>
<p>In most basic models, the time spent in a state (like how long an individual stays a Juvenile) follows an <strong>exponential distribution</strong>. This assumes a ‚Äúmemoryless‚Äù process where an individual has the same probability of leaving the state every day, regardless of how long they have already been there.</p>
</section>
<section class="slide level2">

<p>EMULSION allows you to specify <strong>non-exponential durations</strong>. This is essential for modeling specific life stages (like a fixed pregnancy period) or diseases with a strict incubation time.</p>
<blockquote>
<p><strong>How it works:</strong> When a state has a <code>duration</code> property, individuals are ‚Äúlocked‚Äù in that state until the timer is up, unless a transition is specifically marked to allow an early <strong>escape</strong>.</p>
</blockquote>
</section>
<section class="slide level2 scrollable">

<h3 id="constant-duration-for-juveniles">3.1 Constant Duration for Juveniles</h3>
<p>We will now modify <a href="exercises/step3.yaml">exercises/step3.yaml</a> to make the juvenile stage a fixed length of time (<span class="math inline">\(1/maturation\)</span>) instead of a random average.</p>
<h4 id="instructions">üõ†Ô∏è Instructions:</h4>
<ol type="1">
<li><p><strong>Rename the Model:</strong> Open <a href="exercises/step3.yaml">exercises/step3.yaml</a> and rename the model as <code>stoch_compart_SIR_JA_dur</code>.</p></li>
<li><p><strong>Define the Duration in State J:</strong> In the <code>age_group</code> state machine, add the <code>duration</code> property to state <strong>J</strong>.</p></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><a href=""></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">J</span><span class="kw">:</span></span>
<span id="cb15-2"><a href=""></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">'Juveniles'</span></span>
<span id="cb15-3"><a href=""></a><span class="at">        </span><span class="fu">duration</span><span class="kw">:</span><span class="at"> </span><span class="st">'dur_juvenile'</span></span>
<span id="cb15-4"><a href=""></a><span class="at">        </span><span class="fu">fillcolor</span><span class="kw">:</span><span class="at"> </span><span class="st">'purple'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2 scrollable">

<ol start="3" type="1">
<li><p><strong>Update the Maturation Transition:</strong> Change the transition from <strong>J to A</strong>. Since the duration is now handled by the state ‚Äútimer,‚Äù replace <code>rate: maturation</code> with <code>proba: 1</code>. This tells the engine to move 100% of individuals to the Adult state as soon as the duration ends.</p></li>
<li><p><strong>Enable the Escape Condition:</strong> We don‚Äôt want juveniles to be ‚Äúimmortal‚Äù while they wait to grow up! Mark the transition from <code>**J to D**</code> (mortality) with <code>escape: yes</code>.</p></li>
<li><p><strong>Add the Parameter:</strong> In the <code>parameters</code> section, define <code>dur_juvenile</code> with the value <code>1/maturation</code>.</p></li>
</ol>
</section>
<section class="slide level2">

<h3 id="why-use-escape-yes">üí° Why use <code>escape: yes</code>?</h3>
<p>Without this property, the <code>duration</code> acts like a protective shield. Individuals would be forced to stay in state <strong>J</strong> for the full duration, making them accidentally immune to death until they become adults. The ‚Äúescape‚Äù allows the mortality transition to override the maturation timer.</p>
</section>
<section class="slide level2">

<h3 id="run-the-simulation">üöÄ Run the Simulation</h3>
<p>Execute the cell below to run the updated model.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb16-2"><a href=""></a><span class="bu">cd</span> exercises</span>
<span id="cb16-3"><a href=""></a><span class="ex">emulsion</span> run <span class="at">--plot</span> step3.yaml <span class="at">--silent</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2">

<h4 id="compare-the-outcomes">üìä Compare the Outcomes</h4>
<p>Now that you‚Äôve verified the logic, look at how this changes the epidemic‚Äôs progression:</p>
<ul>
<li><strong>Interactive Plot:</strong> <a href="exercises/img/stoch_compart_SIR_JA_dur.html">exercises/img/stoch_compart_SIR_JA_dur.html</a></li>
</ul>
<p><strong>Discussion Point:</strong> Does the maturation of juveniles still look like a smooth, gradual curve? Or do you see a sudden shift where groups become adults all at once? This effect is the direct result of using fixed durations.</p>
</section>
<section class="slide level2">

<h3 id="interpreting-the-new-model-symbols">üñºÔ∏è Interpreting the New Model Symbols</h3>
<p>When you add advanced logic like <strong>fixed durations</strong> and <strong>escapes</strong>, EMULSION automatically updates the state-machine diagrams. These visual cues are the best way to verify that your YAML code matches your biological intent.</p>
<h4 id="generate-the-diagrams">1. Generate the Diagrams</h4>
<p>Run the following code cell to update the graphical representations for <code>step3.yaml</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href=""></a><span class="ex">%%bash</span></span>
<span id="cb17-2"><a href=""></a><span class="bu">cd</span> exercises</span>
<span id="cb17-3"><a href=""></a><span class="ex">emulsion</span> diagrams step3.yaml</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section class="slide level2 scrollable">

<p>Look at the diagram here: <a href="img/stoch_compart_SIR_JA_dur_age_group_machine.svg">img/stoch_compart_SIR_JA_dur_age_group_machine.svg</a></p>

<img data-src="solutions/img/stoch_compart_SIR_JA_dur_age_group_machine.svg" class="r-stretch"><p>In model diagram, note:</p>
<ol type="1">
<li><p>the nice <strong>clock</strong> attached to states with a specific duration property</p></li>
<li><p>the <strong>triangle</strong> at the beginning of transitions endowed with an escape condition.</p></li>
</ol>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="EMULSION-training_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="EMULSION-training_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="EMULSION-training_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="EMULSION-training_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>